# سرویس تونل IPv6 با ip6tables

این پروژه یک سرویس تونل IPv6 ساده و کارآمد با استفاده از `ip6tables` و قوانین مسیریابی لینوکس ارائه می‌دهد. با این سرویس، ترافیک IPv6 از یک سرور مبدا به سرور مقصد هدایت می‌شود و سپس از آنجا به اینترنت می‌رود.

## ویژگی‌ها

- راه‌اندازی سریع و آسان
- مبتنی بر `ip6tables` و قوانین مسیریابی لینوکس
- پشتیبانی از پورت‌های استثناء
- راه‌اندازی خودکار در هنگام بوت سیستم
- رابط کاربری خط فرمان آسان برای مدیریت

## پیش‌نیازها

- دو سرور لینوکس با دسترسی root
- IPv6 فعال روی هر دو سرور
- دسترسی باز بین دو سرور

## نصب

1. ابتدا پروژه را دریافت کنید:

```bash
git clone https://github.com/yourusername/ipv6tunnel.git
cd ipv6tunnel
```

2. اسکریپت نصب را با دسترسی root اجرا کنید:

```bash
sudo bash install.sh
```

3. مراحل نصب را دنبال کنید و پیکربندی مناسب را انتخاب کنید.

## استفاده

پس از نصب، می‌توانید از دستور `ipv6tunnel` برای مدیریت سرویس استفاده کنید:

### مدیریت با منوی تعاملی

```bash
sudo ipv6tunnel
```

### مدیریت با دستورات مستقیم

```bash
# شروع سرویس
sudo ipv6tunnel start

# توقف سرویس
sudo ipv6tunnel stop

# راه‌اندازی مجدد
sudo ipv6tunnel restart

# نمایش وضعیت
sudo ipv6tunnel status

# اضافه کردن پورت استثناء
sudo ipv6tunnel add-port 22

# حذف پورت استثناء
sudo ipv6tunnel remove-port 22
```

## نحوه کار

### سرور مبدا

1. ترافیک ورودی IPv6 با استفاده از `ip6tables` علامت‌گذاری می‌شود
2. ترافیک‌های مربوط به پورت‌های استثناء با علامت `mark 1` نشانه‌گذاری می‌شوند
3. بقیه ترافیک با علامت `mark 2` نشانه‌گذاری می‌شوند
4. ترافیک با علامت `mark 2` از طریق یک جدول مسیریابی اختصاصی به سرور مقصد هدایت می‌شود

### سرور مقصد

1. ترافیک دریافت شده از سرور مبدا با استفاده از `MASQUERADE` به اینترنت هدایت می‌شود
2. پورت‌های استثناء با استفاده از قوانین `RETURN` در جدول `nat` پردازش می‌شوند
3. IPv6 forwarding در کرنل فعال می‌شود تا ترافیک به درستی مسیریابی شود

## عیب‌یابی

اگر با مشکلی مواجه شدید، این مراحل را دنبال کنید:

1. بررسی وضعیت تونل:
   ```bash
   sudo ipv6tunnel status
   ```

2. بررسی قوانین مسیریابی:
   ```bash
   ip -6 rule show
   ```

3. بررسی جدول مسیریابی:
   ```bash
   ip -6 route show table 200
   ```

4. بررسی قوانین ip6tables:
   ```bash
   ip6tables -t mangle -L -v
   ip6tables -t nat -L -v
   ```

5. بررسی فعال بودن IPv6 forwarding:
   ```bash
   cat /proc/sys/net/ipv6/conf/all/forwarding
   ```

## مجوز

[MIT](LICENSE)